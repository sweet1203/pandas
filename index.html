<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>CSV ë°ì´í„° ë¶„ì„ê¸°</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Noto Sans KR', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem;
      text-align: center;
    }
    
    .header h1 {
      margin: 0;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    
    .header p {
      margin: 0;
      opacity: 0.9;
    }
    
    .content {
      padding: 2rem;
    }
    
    .file-upload {
      border: 3px dashed #667eea;
      border-radius: 15px;
      padding: 3rem 2rem;
      text-align: center;
      margin-bottom: 2rem;
      background-color: #f8f9ff;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .file-upload:hover {
      background-color: #e8ecff;
      border-color: #5a6fd8;
    }
    
    .file-upload.dragover {
      background-color: #e8ecff;
      border-color: #5a6fd8;
      transform: scale(1.02);
    }
    
    .file-upload i {
      font-size: 3rem;
      color: #667eea;
      margin-bottom: 1rem;
      display: block;
    }
    
    .file-upload p {
      font-size: 1.1rem;
      color: #666;
      margin: 0;
    }
    
    .file-upload .small {
      font-size: 0.9rem;
      color: #999;
      margin-top: 0.5rem;
    }
    
    .analysis-result {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #f8f9ff;
      border-radius: 10px;
      border: 1px solid #e8ecff;
      display: none;
    }
    
    .analysis-result h3 {
      color: #667eea;
      margin-top: 0;
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .analysis-result table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 1rem;
      min-width: 600px;
    }
    
    .analysis-result th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 8px;
      text-align: center;
      font-weight: 600;
    }
    
    .analysis-result td {
      padding: 10px 8px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }
    
    .analysis-result tr:nth-child(even) {
      background-color: #f8f9ff;
    }
    
    .analysis-result tr:hover {
      background-color: #e8ecff;
    }
    
    .loading {
      text-align: center;
      color: #667eea;
      font-weight: bold;
      padding: 2rem;
    }
    
    .loading i {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    
    .error {
      background: #ffe6e6;
      color: #d63031;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #ff7675;
      text-align: center;
    }
    
    .info-box {
      background: #e8f4fd;
      border: 1px solid #b3d9ff;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 2rem;
    }
    
    .info-box h4 {
      color: #0066cc;
      margin-top: 0;
    }
    
    .info-box ul {
      margin: 0.5rem 0;
      padding-left: 1.5rem;
    }
    
    .info-box li {
      margin-bottom: 0.3rem;
    }
    
    .table-container {
      overflow-x: auto;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 1rem;
    }
    
    /* PDF ì¶œë ¥ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .pdf-export {
      text-align: center;
      margin-top: 2rem;
      padding: 1rem;
      background: #f8f9ff;
      border-radius: 10px;
      border: 1px solid #e8ecff;
    }
    
    .pdf-export button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .pdf-export button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    .pdf-export button:active {
      transform: translateY(0);
    }
    
    /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
    @media print {
      body {
        background: white !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      .container {
        box-shadow: none !important;
        border-radius: 0 !important;
        max-width: none !important;
      }
      
      .header {
        background: #667eea !important;
        color: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      .file-upload,
      .info-box,
      .pdf-export {
        display: none !important;
      }
      
      .content {
        padding: 1rem !important;
      }
      
      .analysis-result {
        display: block !important;
        background: white !important;
        border: none !important;
        padding: 0 !important;
      }
      
      .analysis-result table {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
      }
      
      .analysis-result th {
        background: #667eea !important;
        color: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      .table-container {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
      }
      
      /* í˜ì´ì§€ ë‚˜ëˆ„ê¸° ë°©ì§€ */
      .analysis-result h3 {
        page-break-after: avoid;
      }
      
      .analysis-result table {
        page-break-inside: avoid;
      }
    }
    
    @media (max-width: 768px) {
      .container {
        margin: 0;
        border-radius: 0;
      }
      
      .header {
        padding: 1.5rem;
      }
      
      .header h1 {
        font-size: 1.5rem;
      }
      
      .content {
        padding: 1rem;
      }
      
      .file-upload {
        padding: 2rem 1rem;
      }
      
      .analysis-result table {
        font-size: 0.8rem;
      }
      
      .analysis-result th,
      .analysis-result td {
        padding: 6px 4px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“Š CSV ë°ì´í„° ë¶„ì„ê¸°</h1>
      <p>pandas info(), describe(), ê²°ì¸¡ì¹˜ ë¶„ì„ ë° ì²˜ë¦¬ë¥¼ ì›¹ì—ì„œ ì‚¬ìš©í•´ë³´ì„¸ìš”</p>
    </div>
    
    <div class="content">
      <div class="info-box">
        <h4>ğŸ“‹ ì‚¬ìš© ë°©ë²•</h4>
        <ul>
          <li><strong>1. íŒŒì¼ ì—…ë¡œë“œ</strong>: CSV íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</li>
          <li><strong>2. ë°ì´í„° ì •ë³´ í™•ì¸</strong>: ì»¬ëŸ¼ë³„ ë°ì´í„° íƒ€ì…, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë“± ìƒì„¸ ì •ë³´</li>
          <li><strong>3. ê²°ì¸¡ì¹˜ ë¶„ì„</strong>: ê° ì»¬ëŸ¼ë³„ ê²°ì¸¡ì¹˜ ê°œìˆ˜ì™€ ë¹„ìœ¨ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸</li>
          <li><strong>4. ê²°ì¸¡ì¹˜ ì²˜ë¦¬</strong>: ì‚­ì œ, í‰ê· ê°’ ëŒ€ì²´, ìµœë¹ˆê°’ ëŒ€ì²´ ì¤‘ ì„ íƒ</li>
          <li><strong>5. í†µê³„ ë¶„ì„</strong>: pandas describe()ì™€ ë™ì¼í•œ í†µê³„ ì •ë³´ (count, mean, std, min, 25%, 50%, 75%, max)</li>
          <li><strong>6. íŠ¹ì • ì—´ ë¶„ì„</strong>: ì›í•˜ëŠ” ì»¬ëŸ¼ë§Œ ì„ íƒí•˜ì—¬ ìƒì„¸ ë¶„ì„</li>
        </ul>
        
        <h4>âš ï¸ ì£¼ì˜ì‚¬í•­</h4>
        <ul>
          <li><strong>ì—‘ì…€ íŒŒì¼ ì‚¬ìš© ì‹œ:</strong> "ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥" â†’ "íŒŒì¼ í˜•ì‹: CSV UTF-8"ë¡œ ì €ì¥í•´ì£¼ì„¸ìš”</li>
          <li>í•œê¸€ ê¹¨ì§ ë°©ì§€ë¥¼ ìœ„í•´ UTF-8 ì¸ì½”ë”©ì„ ê¶Œì¥í•©ë‹ˆë‹¤</li>
          <li>ëŒ€ìš©ëŸ‰ íŒŒì¼(100MB ì´ìƒ)ì€ ì²˜ë¦¬ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
        </ul>
      </div>
      
      <div class="file-upload" id="fileUpload">
        <i class="fas fa-cloud-upload-alt"></i>
        <p>ğŸ“ CSV íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
        <p class="small">ğŸ’¡ ì§€ì› í˜•ì‹: .csv íŒŒì¼</p>
        <input type="file" id="csvFile" accept=".csv" style="display: none;">
      </div>
      
      <div id="loadingIndicator" class="loading" style="display: none;">
        <i class="fas fa-spinner fa-spin"></i>
        <p>ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
      </div>
      
      <div id="analysisResult" class="analysis-result"></div>
    </div>
  </div>
  
  <!-- ì œì‘ì ì •ë³´ -->
  <div style="text-align: center; padding: 20px; margin-top: 20px; color: #666; font-size: 0.9rem; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Noto Sans KR', sans-serif;">
    <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: inline-block;">
      <span style="color: #ff69b4;">ğŸ’–</span>
      <strong style="color: #333;">ëŒ€ì„±ì—¬ê³  ì •ë³´ìŒ¤ ì œì‘</strong>
      <span style="color: #ff69b4;">ğŸ’–</span>
    </div>
  </div>

  <script>
    let globalData = null; // ì „ì—­ ë³€ìˆ˜ë¡œ ë°ì´í„° ì €ì¥
    let globalInfoData = null;
    let originalData = null; // ì›ë³¸ ë°ì´í„° ë³´ì¡´

    function calculateInfo(data) {
      const info = {
        totalRows: data.length - 1,
        totalColumns: data[0].length,
        columns: []
      };

      data[0].forEach((header, index) => {
        let nonNullCount = 0;
        let numericCount = 0;
        
        for (let i = 1; i < data.length; i++) {
          const cellValue = data[i][index];
          if (cellValue && cellValue.toString().trim() !== '') {
            nonNullCount++;
            if (!isNaN(parseFloat(cellValue))) {
              numericCount++;
            }
          }
        }

        const dtype = (nonNullCount > 0 && (numericCount / nonNullCount) >= 0.5) ? 'float64' : 'object';
        
        info.columns.push({
          name: header,
          nonNullCount: nonNullCount,
          dtype: dtype
        });
      });

      // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê³„ì‚° (ëŒ€ëµì ì¸ ì¶”ì •)
      info.memoryUsage = ((info.totalRows * info.totalColumns * 8) / 1024).toFixed(2);

      return info;
    }

    function calculateDescribe(data, selectedColumn = null) {
      console.log('=== calculateDescribe í•¨ìˆ˜ ì‹œì‘ ===');
      console.log('ì…ë ¥ ë°ì´í„°:', data ? data.length : 'null', 'í–‰');
      console.log('ì„ íƒëœ ì—´:', selectedColumn);
      
      const numericColumns = [];
      const results = {};

      // ìˆ«ìí˜• ì»¬ëŸ¼ ì°¾ê¸° (ìºì‹± í™œìš©)
      if (!data._numericColumnsCache) {
        console.log('ìºì‹œê°€ ì—†ì–´ì„œ ìƒˆë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.');
        data._numericColumnsCache = [];
        console.log('=== ìˆ«ìí˜• ì»¬ëŸ¼ ì°¾ê¸° ì‹œì‘ ===');
        console.log('ì´ ì»¬ëŸ¼ ìˆ˜:', data[0].length);
        console.log('ì´ í–‰ ìˆ˜:', data.length);
        console.log('í—¤ë” í–‰:', data[0]);
        
        if (!data[0] || !Array.isArray(data[0])) {
          console.error('âŒ data[0]ì´ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', data[0]);
          return results;
        }
        
        data[0].forEach((header, index) => {
          let numericCount = 0;
          let totalValidCount = 0;
          
          console.log(`\n--- ì»¬ëŸ¼ ${index}: ${header} ë¶„ì„ ---`);
          
          // ì „ì²´ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì—¬ ìˆ«ìí˜• ì—¬ë¶€ íŒë‹¨
          for (let i = 1; i < data.length; i++) {
            const cellValue = data[i][index];
            if (cellValue && cellValue.toString().trim() !== '') {
              totalValidCount++;
              const numValue = parseFloat(cellValue);
              if (!isNaN(numValue)) {
                numericCount++;
                if (numericCount <= 3) {
                  console.log(`  í–‰ ${i}: "${cellValue}" â†’ ${numValue} (ìˆ«ì)`);
                }
              } else {
                if (totalValidCount - numericCount <= 3) {
                  console.log(`  í–‰ ${i}: "${cellValue}" â†’ ìˆ«ì ì•„ë‹˜`);
                }
              }
            }
          }
          
          console.log(`ì»¬ëŸ¼ ${index} ê²°ê³¼: ìˆ«ì ${numericCount}ê°œ, ì´ ìœ íš¨ê°’ ${totalValidCount}ê°œ`);
          
          // ìœ íš¨í•œ ê°’ ì¤‘ 50% ì´ìƒì´ ìˆ«ìì¸ ê²½ìš° ìˆ«ìí˜• ì»¬ëŸ¼ìœ¼ë¡œ ì¸ì‹
          if (totalValidCount > 0 && (numericCount / totalValidCount) >= 0.5) {
            data._numericColumnsCache.push(index);
            console.log(`âœ… ì»¬ëŸ¼ ${index} (${header}): ìˆ«ìí˜•ìœ¼ë¡œ ì¸ì‹ (${numericCount}/${totalValidCount})`);
          } else {
            console.log(`âŒ ì»¬ëŸ¼ ${index} (${header}): ë¬¸ìì—´í˜•ìœ¼ë¡œ ì¸ì‹ (${numericCount}/${totalValidCount})`);
          }
        });
        
        console.log('=== ìˆ«ìí˜• ì»¬ëŸ¼ ì°¾ê¸° ì™„ë£Œ ===');
        console.log('ìˆ«ìí˜• ì»¬ëŸ¼ ì¸ë±ìŠ¤:', data._numericColumnsCache);
      }

      // íŠ¹ì • ì—´ì„ ì„ íƒí•œ ê²½ìš°ì™€ ì „ì²´ ì—´ ë¶„ì„ì„ êµ¬ë¶„
      let columnsToProcess = [];
      if (selectedColumn !== null && selectedColumn !== '') {
        // íŠ¹ì • ì—´ì„ ì„ íƒí•œ ê²½ìš°, í•´ë‹¹ ì—´ë§Œ ë¶„ì„
        const columnIndex = parseInt(selectedColumn);
        if (!isNaN(columnIndex) && columnIndex >= 0 && columnIndex < data[0].length) {
          columnsToProcess = [columnIndex];
          console.log(`íŠ¹ì • ì—´ ${columnIndex} ì„ íƒë¨: ${data[0][columnIndex]}`);
        } else {
          console.log(`ì˜ëª»ëœ ì—´ ì¸ë±ìŠ¤: ${selectedColumn}, ì „ì²´ ì—´ ë¶„ì„ìœ¼ë¡œ ë³€ê²½`);
          columnsToProcess = data._numericColumnsCache;
        }
      } else {
        // ì „ì²´ ì—´ ë¶„ì„ì˜ ê²½ìš°, ìˆ«ìí˜• ì»¬ëŸ¼ë§Œ ë¶„ì„
        columnsToProcess = data._numericColumnsCache;
        console.log('ì „ì²´ ì—´ ë¶„ì„ ëª¨ë“œ');
      }

      // ê° ì„ íƒëœ ì»¬ëŸ¼ì— ëŒ€í•´ describe ê³„ì‚°
      columnsToProcess.forEach(colIndex => {
        const columnName = data[0][colIndex];
        const values = [];
        
        console.log(`ì»¬ëŸ¼ ${colIndex} (${columnName}) ë¶„ì„ ì‹œì‘`);
        
        // ìˆ«ìí˜• ë°ì´í„° ìˆ˜ì§‘
        for (let i = 1; i < data.length; i++) {
          const cellValue = data[i][colIndex];
          if (cellValue && cellValue.toString().trim() !== '') {
            const numValue = parseFloat(cellValue);
            if (!isNaN(numValue)) {
              values.push(numValue);
              if (values.length <= 3) {
                console.log(`  í–‰ ${i}: "${cellValue}" â†’ ${numValue} (ìˆ«ìë¡œ ë³€í™˜ë¨)`);
              }
            } else {
              if (values.length <= 3) {
                console.log(`  í–‰ ${i}: "${cellValue}" â†’ ìˆ«ì ë³€í™˜ ì‹¤íŒ¨`);
              }
            }
          }
        }

        console.log(`ì»¬ëŸ¼ ${columnName}: ì´ ${values.length}ê°œì˜ ìˆ«ì ë°ì´í„° ìˆ˜ì§‘ë¨`);

        // ìˆ«ìí˜• ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ê²°ê³¼ ì¶”ê°€
        if (values.length > 0) {
          values.sort((a, b) => a - b);
          const count = values.length;
          const mean = values.reduce((a, b) => a + b, 0) / count;
          const std = Math.sqrt(values.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / count);
          
          results[columnName] = {
            count: count,
            mean: mean.toFixed(2),
            std: std.toFixed(2),
            min: values[0].toFixed(2),
            '25%': values[Math.floor(count * 0.25)].toFixed(2),
            '50%': values[Math.floor(count * 0.5)].toFixed(2),
            '75%': values[Math.floor(count * 0.75)].toFixed(2),
            max: values[values.length - 1].toFixed(2)
          };
          
          console.log(`ì»¬ëŸ¼ ${columnName} ë¶„ì„ ì™„ë£Œ: ${count}ê°œ ë°ì´í„°`);
        } else {
          console.log(`ì»¬ëŸ¼ ${columnName}: ìˆ«ì ë°ì´í„° ì—†ìŒ`);
        }
      });

      return results;
    }

    function calculateMissingData(data) {
      // ë§ˆì§€ë§‰ í–‰ì´ ì™„ì „íˆ ë¹„ì–´ìˆìœ¼ë©´ ì œê±°
      let cleanData = [...data];
      if (cleanData.length > 1) {
        const lastRow = cleanData[cleanData.length - 1];
        const isLastRowEmpty = lastRow.every(cell => cell === null || cell === undefined || cell === '' || (typeof cell === 'string' && cell.trim() === ''));
        if (isLastRowEmpty) {
          cleanData = cleanData.slice(0, -1);
          console.log('ë§ˆì§€ë§‰ ë¹ˆ í–‰ ì œê±°ë¨');
        }
      }

      const missingInfo = {
        totalRows: cleanData.length - 1,
        totalColumns: cleanData[0].length,
        columns: []
      };

      let totalNulls = 0;
      let totalCells = 0;

      console.log('=== ê²°ì¸¡ì¹˜ ë¶„ì„ ë””ë²„ê¹… ===');
      console.log('ì›ë³¸ í–‰ ìˆ˜:', data.length - 1);
      console.log('ì •ë¦¬ëœ í–‰ ìˆ˜:', missingInfo.totalRows);
      console.log('ì´ ì—´ ìˆ˜:', missingInfo.totalColumns);

      cleanData[0].forEach((header, index) => {
        let nullCount = 0;
        let nonNullCount = 0;
        
        console.log(`\n--- ì—´ ${index}: ${header} ---`);
        
        for (let i = 1; i < cleanData.length; i++) {
          const value = cleanData[i][index];
          
          // ê²°ì¸¡ì¹˜ íŒë‹¨: null, undefined, ë¹ˆ ë¬¸ìì—´, ê³µë°±ë§Œ ìˆëŠ” ë¬¸ìì—´
          if (value === null || value === undefined || value === '' || (typeof value === 'string' && value.trim() === '')) {
            nullCount++;
            console.log(`í–‰ ${i}: ê°’="${value}" â†’ ê²°ì¸¡ì¹˜ë¡œ íŒë‹¨ (nullCount: ${nullCount})`);
          } else {
            nonNullCount++;
            console.log(`í–‰ ${i}: ê°’="${value}" â†’ ìœ íš¨í•œ ê°’ìœ¼ë¡œ íŒë‹¨ (nonNullCount: ${nonNullCount})`);
          }
        }

        console.log(`ìµœì¢… ê²°ê³¼: nullCount=${nullCount}, nonNullCount=${nonNullCount}`);

        totalNulls += nullCount;
        totalCells += missingInfo.totalRows;

        const nullPercentage = ((nullCount / missingInfo.totalRows) * 100).toFixed(2);
        
        missingInfo.columns.push({
          name: header,
          nullCount: nullCount,
          nonNullCount: nonNullCount,
          nullPercentage: nullPercentage,
          totalCount: missingInfo.totalRows
        });
      });

      missingInfo.totalNulls = totalNulls;
      missingInfo.totalCells = totalCells;

      console.log(`\n=== ì „ì²´ ê²°ê³¼ ===`);
      console.log(`ì „ì²´ ê²°ì¸¡ì¹˜: ${totalNulls} / ${totalCells}`);
      console.log('=== ë””ë²„ê¹… ë ===\n');

      return missingInfo;
    }

    function displayInfoResult(data) {
      let html = '<h3><i class="fas fa-info-circle" style="margin-right: 0.5rem;"></i>ğŸ“ˆ ë°ì´í„° ì •ë³´ (pandas info)</h3>';
      html += '<div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; font-family: monospace; font-size: 0.9rem;">';
      html += `<div style="margin-bottom: 0.5rem;"><strong>RangeIndex:</strong> ${data.totalRows} entries, 0 to ${data.totalRows - 1}</div>`;
      html += `<div style="margin-bottom: 0.5rem;"><strong>Data columns (total ${data.totalColumns} columns):</strong></div>`;
      
      html += '<div class="table-container">';
      html += '<table style="width: 100%; border-collapse: collapse; margin-top: 0.5rem; min-width: 600px;">';
      html += '<thead><tr style="border-bottom: 1px solid #ddd;">';
      html += '<th style="text-align: left; padding: 4px 8px; font-weight: bold;">#</th>';
      html += '<th style="text-align: left; padding: 4px 8px; font-weight: bold;">Column</th>';
      html += '<th style="text-align: center; padding: 4px 8px; font-weight: bold;">Non-Null</th>';
      html += '<th style="text-align: center; padding: 4px 8px; font-weight: bold;">Dtype</th>';
      html += '</tr></thead><tbody>';
      
      data.columns.forEach((col, index) => {
        html += '<tr style="border-bottom: 1px solid #eee;">';
        html += `<td style="padding: 4px 8px;">${index}</td>`;
        html += `<td style="padding: 4px 8px;">${col.name}</td>`;
        html += `<td style="padding: 4px 8px; text-align: center;">${col.nonNullCount}</td>`;
        html += `<td style="padding: 4px 8px; text-align: center;">${col.dtype}</td>`;
        html += '</tr>';
      });
      
      html += '</tbody></table>';
      html += '</div>';
      
      html += `<div style="margin-top: 1rem; padding-top: 0.5rem; border-top: 1px solid #ddd;">`;
      html += `<strong>Memory usage:</strong> ${data.memoryUsage} KB`;
      html += '</div></div>';
      
      return html;
    }

    function displayMissingDataResult(missingData, hideProcessingMenu = false) {
      let html = '<h3><i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>ğŸ” ê²°ì¸¡ì¹˜ ë¶„ì„</h3>';
      html += '<div class="table-container">';
      html += '<table><thead><tr><th>ì—´ ë²ˆí˜¸</th><th>ì—´ ì´ë¦„</th><th>ì´ ê°œìˆ˜</th><th>ê²°ì¸¡ì¹˜ ê°œìˆ˜</th><th>ê²°ì¸¡ì¹˜ ë¹„ìœ¨</th></tr></thead><tbody>';
      
      missingData.columns.forEach((col, index) => {
        const percentage = ((col.nullCount / col.totalCount) * 100).toFixed(2);
        const rowClass = col.nullCount > 0 ? 'style="background-color: #fff3cd;"' : '';
        html += `<tr ${rowClass}>`;
        html += `<td>${index}</td>`;
        html += `<td>${col.name}</td>`;
        html += `<td>${col.totalCount}</td>`;
        html += `<td>${col.nullCount}</td>`;
        html += `<td>${percentage}%</td>`;
        html += '</tr>';
      });
      
      html += '</tbody></table>';
      html += '</div>';
      
      const totalNulls = missingData.totalNulls;
      const totalCells = missingData.totalCells;
      const totalNullPercentage = ((totalNulls / totalCells) * 100).toFixed(2);
      
      html += `<div style="margin-top: 1rem; padding-top: 0.5rem; border-top: 1px solid #ddd;">`;
      html += `<strong>ì „ì²´ ê²°ì¸¡ì¹˜:</strong> ${totalNulls} / ${totalCells} (${totalNullPercentage}%)`;
      html += '</div></div>';
      
      // ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë©”ë‰´ëŠ” hideProcessingMenuê°€ falseì¼ ë•Œë§Œ í‘œì‹œ
      if (!hideProcessingMenu) {
        html += '<div style="background: #fff3cd; padding: 1.5rem; border-radius: 10px; border: 1px solid #ffeaa7; margin-bottom: 1rem;">';
        html += '<h4 style="color: #856404; margin-bottom: 1rem; margin-top: 0;">';
        html += '<i class="fas fa-tools" style="margin-right: 0.5rem;"></i>ğŸ§¹ ê²°ì¸¡ì¹˜ ì²˜ë¦¬';
        html += '</h4>';
        html += '<div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">';
        html += '<label for="missingColumnSelect" style="font-weight: bold;">ì²˜ë¦¬í•  ì—´:</label>';
        html += '<select id="missingColumnSelect" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;">';
        html += '<option value="">ì „ì²´ ì—´</option>';
        
        missingData.columns.forEach((col, index) => {
          if (col.nullCount > 0) {
            html += `<option value="${index}">${index}: ${col.name} (${col.nullCount}ê°œ ê²°ì¸¡)</option>`;
          }
        });
        
        html += '</select>';
        html += '<label for="missingMethodSelect" style="font-weight: bold;">ì²˜ë¦¬ ë°©ë²•:</label>';
        html += '<select id="missingMethodSelect" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; min-width: 150px;" onchange="toggleCustomValueInput()">';
        html += '<option value="delete">ê²°ì¸¡ì¹˜ ì‚­ì œ</option>';
        html += '<option value="mean">í‰ê· ê°’ ëŒ€ì²´</option>';
        html += '<option value="mode">ìµœë¹ˆê°’ ëŒ€ì²´</option>';
        html += '<option value="custom">ì‚¬ìš©ì ì§€ì • ê°’</option>';
        html += '<option value="median">ì¤‘ì•™ê°’ìœ¼ë¡œ ëŒ€ì²´</option>';
        html += '<option value="forward_fill">ì•ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸°</option>';
        html += '<option value="backward_fill">ë’¤ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸°</option>';
        html += '</select>';
        html += '<div id="customValueContainer" style="display: none; flex: 1; min-width: 200px;">';
        html += '<label for="customValueInput" style="font-weight: bold; margin-right: 0.5rem;">ì§€ì • ê°’:</label>';
        html += '<input type="text" id="customValueInput" placeholder="ì˜ˆ: 0, N/A, ë¹ˆì¹¸" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; width: 100%;">';
        html += '</div>';
        html += '<button id="processMissing" style="padding: 0.5rem 1rem; background: #856404; color: white; border: none; border-radius: 4px; cursor: pointer;">';
        html += '<i class="fas fa-magic" style="margin-right: 0.5rem;"></i>ì²˜ë¦¬';
        html += '</button>';
        html += '</div>';
        html += '<div style="margin-top: 0.5rem; font-size: 0.9rem; color: #856404;">';
        html += '<strong>ì°¸ê³ :</strong> ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” ì—´ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì‚¬ìš©ì ì§€ì • ê°’ì€ ëª¨ë“  ê²°ì¸¡ì¹˜ë¥¼ ë™ì¼í•œ ê°’ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.';
        html += '<br><strong>ğŸ”’ ì¸ë±ìŠ¤ ì—´ ë³´í˜¸:</strong> 1ì—´(ì¸ë±ìŠ¤ ì—´)ì€ ë°ì´í„° êµ¬ë¶„ì„ ìœ„í•´ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.';
        html += '</div>';
        html += '</div>';
      }
      
      return html;
    }

    function displayDescribeResult(describeData) {
      let html = '<h3><i class="fas fa-chart-bar" style="margin-right: 0.5rem;"></i>ğŸ“Š ë°ì´í„° ë¶„ì„ ê²°ê³¼ (pandas describe)</h3>';
      html += '<div class="table-container">';
      html += '<table><thead><tr><th>í†µê³„</th>';
      
      const columns = Object.keys(describeData);
      columns.forEach(col => {
        html += `<th>${col}</th>`;
      });
      html += '</tr></thead><tbody>';

      const stats = ['count', 'mean', 'std', 'min', '25%', '50%', '75%', 'max'];
      stats.forEach(stat => {
        html += `<tr><td style="font-weight: bold; color: #667eea;">${stat}</td>`;
        columns.forEach(col => {
          html += `<td>${describeData[col][stat]}</td>`;
        });
        html += '</tr>';
      });

      html += '</tbody></table>';
      html += '</div>';
      
      return html;
    }
    
    function displayAllResults(describeData, missingData, data) {
      globalData = data; // ì „ì—­ ë³€ìˆ˜ì— ë°ì´í„° ì €ì¥
      
      const resultDiv = document.getElementById('analysisResult');
      resultDiv.style.display = 'block';

      let html = '';
      
      // Info ê²°ê³¼
      const infoData = calculateInfo(data);
      html += displayInfoResult(infoData);
      
      // Describe ê²°ê³¼ (ì›ë³¸ ë°ì´í„° ë¶„ì„)
      if (Object.keys(describeData).length === 0) {
        html += `
          <div class="error">
            <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>
            ë¶„ì„í•  ìˆ˜ ìˆëŠ” ìˆ«ìí˜• ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
            <br><br>
            <strong>ê°€ëŠ¥í•œ ì›ì¸:</strong>
            <ul style="text-align: left; margin: 0.5rem 0;">
              <li>ëª¨ë“  ì»¬ëŸ¼ì´ ë¬¸ìì—´ ë°ì´í„°ì…ë‹ˆë‹¤</li>
              <li>ê²°ì¸¡ì¹˜ ì²˜ë¦¬ í›„ ìˆ«ìí˜• ì»¬ëŸ¼ì´ ë¬¸ìì—´ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤</li>
              <li>ê²°ì¸¡ì¹˜ ì‚­ì œë¡œ ì¸í•´ ëª¨ë“  ë°ì´í„°ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤</li>
            </ul>
            <br>
            ğŸ’¡ <strong>í•´ê²° ë°©ë²•:</strong> ë‹¤ë¥¸ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë°©ë²•ì„ ì‹œë„í•˜ê±°ë‚˜, ì›ë³¸ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì—…ë¡œë“œí•´ë³´ì„¸ìš”.
          </div>
        `;
      } else {
        html += displayDescribeResult(describeData);
      }
      
      // ê²°ì¸¡ì¹˜ ë¶„ì„ ê²°ê³¼ (ë°ì´í„° ë¶„ì„ ê²°ê³¼ ì•„ë˜ë¡œ ì´ë™)
      html += displayMissingDataResult(missingData);
      
      resultDiv.innerHTML = html;
      
      // PDF ì¶œë ¥ ë²„íŠ¼ ì¶”ê°€
      if (Object.keys(describeData).length > 0 || missingData.columns.some(col => col.nullCount > 0)) {
        resultDiv.innerHTML += `
          <div class="pdf-export">
            <button onclick="exportToPDF()">
              <i class="fas fa-file-pdf" style="margin-right: 0.5rem;"></i>
              ğŸ“„ PDFë¡œ ì¶œë ¥í•˜ê¸°
            </button>
            <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
              ğŸ’¡ ë¸Œë¼ìš°ì €ì˜ ì¸ì‡„ ëŒ€í™”ìƒìì—ì„œ "ëŒ€ìƒ"ì„ "PDFë¡œ ì €ì¥"ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”
            </p>
          </div>
        `;
      }
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í•œ ë²ˆë§Œ ì„¤ì •
      setupEventListeners();
    }
    
    function setupEventListeners() {
      console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘');
      
      // ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const processButton = document.getElementById('processMissing');
      if (processButton) {
        // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
        processButton.removeEventListener('click', handleProcessMissingClick);
        processButton.addEventListener('click', handleProcessMissingClick);
        console.log('ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ ì„¤ì •ë¨');
      }
      
      // ì‚¬ìš©ì ì§€ì • ê°’ ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const customValueInput = document.getElementById('customValueInput');
      if (customValueInput) {
        // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
        customValueInput.removeEventListener('keypress', handleCustomValueKeypress);
        customValueInput.addEventListener('keypress', handleCustomValueKeypress);
        console.log('ì‚¬ìš©ì ì§€ì • ê°’ ì…ë ¥ í•„ë“œ ë¦¬ìŠ¤ë„ˆ ì„¤ì •ë¨');
      }
      
      // ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë°©ë²• ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const methodSelect = document.getElementById('missingMethodSelect');
      if (methodSelect) {
        // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
        methodSelect.removeEventListener('change', toggleCustomValueInput);
        methodSelect.addEventListener('change', toggleCustomValueInput);
        console.log('ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë°©ë²• ì„ íƒ ë¦¬ìŠ¤ë„ˆ ì„¤ì •ë¨');
      }
      
      console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
    }
    
    // ì‚¬ìš©ì ì§€ì • ê°’ ì…ë ¥ í•„ë“œ í‚¤í”„ë ˆìŠ¤ í•¸ë“¤ëŸ¬
    function handleCustomValueKeypress(e) {
      if (e.key === 'Enter') {
        handleProcessMissingClick();
      }
    }

    function handleProcessMissingClick() {
      console.log('=== handleProcessMissingClick ì‹œì‘ ===');
      
      const columnSelect = document.getElementById('missingColumnSelect');
      const methodSelect = document.getElementById('missingMethodSelect');
      
      if (!columnSelect || !methodSelect) {
        console.error('âŒ í•„ìš”í•œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const selectedColumn = columnSelect.value;
      const selectedMethod = methodSelect.value;
      
      console.log('ì„ íƒëœ ì—´:', selectedColumn);
      console.log('ì„ íƒëœ ë°©ë²•:', selectedMethod);
      console.log('originalData ìƒíƒœ:', originalData ? 'ì¡´ì¬í•¨' : 'null');
      
      if (!selectedMethod) {
        alert('ì²˜ë¦¬ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // originalDataê°€ nullì¸ì§€ í™•ì¸
      if (!originalData || originalData.length === 0) {
        console.error('âŒ originalDataê°€ nullì´ê±°ë‚˜ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
        alert('ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì‚¬ìš©ì ì§€ì • ê°’ í™•ì¸
      let customValue = null;
      if (selectedMethod === 'custom') {
        const customValueInput = document.getElementById('customValueInput');
        if (!customValueInput || !customValueInput.value.trim()) {
          alert('ì‚¬ìš©ì ì§€ì • ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        customValue = customValueInput.value.trim();
      }
      
      console.log('ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ì‹œì‘...');
      
      // í˜„ì¬ ë°ì´í„°ë¡œ ê²°ì¸¡ì¹˜ ì²˜ë¦¬
      const processedData = processMissingData(originalData, selectedColumn, selectedMethod, customValue);
      
      console.log('ì²˜ë¦¬ëœ ë°ì´í„°:', processedData ? processedData.length : 'null', 'í–‰');
      
      // ë°ì´í„°ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
      if (!processedData || processedData.length <= 1) {
        alert('ê²°ì¸¡ì¹˜ ì²˜ë¦¬ í›„ ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì²˜ë¦¬ ë°©ë²•ì„ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ìºì‹œ ì´ˆê¸°í™” (ê²°ì¸¡ì¹˜ ì²˜ë¦¬ í›„ ë°ì´í„°ê°€ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ)
      processedData._numericColumnsCache = null;
      
      // ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
      globalData = processedData;
      window.processedData = processedData; // íŠ¹ì • ì—´ ë¶„ì„ì„ ìœ„í•´ ë³„ë„ ì €ì¥
      
      console.log('ì „ì—­ ë³€ìˆ˜ì— ë°ì´í„° ì €ì¥ ì™„ë£Œ');
      
      // ì²˜ë¦¬ëœ ë°ì´í„°ë¡œ ë¶„ì„ ê²°ê³¼ ì—…ë°ì´íŠ¸
      const describeData = calculateDescribe(processedData);
      const missingData = calculateMissingData(processedData);
      
      console.log('ë¶„ì„ ì™„ë£Œ, ê²°ê³¼ í‘œì‹œ ì‹œì‘...');
      
      // ê²°ê³¼ í‘œì‹œ ì—…ë°ì´íŠ¸
      displayProcessedResults(originalData, processedData, selectedColumn, selectedMethod, customValue);
      
      // ì²˜ë¦¬ ì™„ë£Œ ë©”ì‹œì§€
      const methodNames = {
        'delete': 'ê²°ì¸¡ì¹˜ ì‚­ì œ',
        'mean': 'í‰ê· ê°’ ëŒ€ì²´',
        'mode': 'ìµœë¹ˆê°’ ëŒ€ì²´',
        'custom': `ì‚¬ìš©ì ì§€ì • ê°’ (${customValue})`,
        'median': 'ì¤‘ì•™ê°’ìœ¼ë¡œ ëŒ€ì²´',
        'forward_fill': 'ì•ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸°',
        'backward_fill': 'ë’¤ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸°'
      };
      
      const columnName = selectedColumn === '' ? 'ì „ì²´ ì—´' : 
        originalData[0][parseInt(selectedColumn)];
      
      console.log('=== handleProcessMissingClick ì™„ë£Œ ===');
      alert(`${columnName}ì— ëŒ€í•´ ${methodNames[selectedMethod]} ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    // ê²°ì¸¡ì¹˜ ì²˜ë¦¬ í›„ ìƒˆë¡œìš´ ë¶„ì„ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
    function displayProcessedResults(originalData, processedData, selectedColumn, selectedMethod, customValue) {
      const resultDiv = document.getElementById('analysisResult');
      
      // ì²˜ë¦¬ëœ ë°ì´í„°ë¡œ ìƒˆë¡œìš´ ë¶„ì„ ìˆ˜í–‰
      processedData._numericColumnsCache = null;
      const processedDescribeData = calculateDescribe(processedData);
      const processedMissingData = calculateMissingData(processedData);
      const processedInfoData = calculateInfo(processedData);
      
      // ì›ë³¸ ë°ì´í„° ë¶„ì„ ê²°ê³¼
      const originalDescribeData = calculateDescribe(originalData);
      const originalMissingData = calculateMissingData(originalData);
      const originalInfoData = calculateInfo(originalData);
      
      let html = '';
      
      // ì›ë³¸ ë°ì´í„° Info ê²°ê³¼
      html += '<h3><i class="fas fa-info-circle" style="margin-right: 0.5rem;"></i>ğŸ“ˆ ì›ë³¸ ë°ì´í„° ì •ë³´</h3>';
      html += displayInfoResult(originalInfoData);
      
      // ì›ë³¸ ë°ì´í„° Describe ê²°ê³¼
      if (Object.keys(originalDescribeData).length === 0) {
        html += `
          <div class="error">
            <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>
            ì›ë³¸ ë°ì´í„°ì— ë¶„ì„í•  ìˆ˜ ìˆëŠ” ìˆ«ìí˜• ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
          </div>
        `;
      } else {
        html += '<h3><i class="fas fa-chart-bar" style="margin-right: 0.5rem;"></i>ğŸ“Š ì›ë³¸ ë°ì´í„° ë¶„ì„ ê²°ê³¼</h3>';
        html += displayDescribeResult(originalDescribeData);
      }
      
      // ì›ë³¸ ë°ì´í„° ê²°ì¸¡ì¹˜ ë¶„ì„
      html += '<h3><i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>ğŸ” ì›ë³¸ ë°ì´í„° ê²°ì¸¡ì¹˜ ë¶„ì„</h3>';
      html += displayMissingDataResult(originalMissingData);
      
      // ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ì •ë³´
      const methodNames = {
        'delete': 'ê²°ì¸¡ì¹˜ ì‚­ì œ',
        'mean': 'í‰ê· ê°’ ëŒ€ì²´',
        'mode': 'ìµœë¹ˆê°’ ëŒ€ì²´',
        'custom': `ì‚¬ìš©ì ì§€ì • ê°’ (${customValue})`,
        'median': 'ì¤‘ì•™ê°’ìœ¼ë¡œ ëŒ€ì²´',
        'forward_fill': 'ì•ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸°',
        'backward_fill': 'ë’¤ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸°'
      };
      
      const columnName = selectedColumn === '' ? 'ì „ì²´ ì—´' : 
        originalData[0][parseInt(selectedColumn)];
      
      html += `
        <div style="background: #e8f5e8; padding: 1.5rem; border-radius: 10px; border: 1px solid #4caf50; margin: 2rem 0;">
          <h3 style="color: #2e7d32; margin-top: 0; margin-bottom: 1rem;">
            <i class="fas fa-check-circle" style="margin-right: 0.5rem;"></i>âœ… ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ì™„ë£Œ
          </h3>
          <div style="color: #2e7d32; font-weight: bold; margin-bottom: 1rem;">
            ì²˜ë¦¬ ëŒ€ìƒ: ${columnName}<br>
            ì²˜ë¦¬ ë°©ë²•: ${methodNames[selectedMethod]}<br>
            ì²˜ë¦¬ëœ í–‰ ìˆ˜: ${originalData.length - 1} â†’ ${processedData.length - 1}
          </div>
          <div style="font-size: 0.9rem; color: #2e7d32;">
            ğŸ’¡ ì•„ë˜ì—ì„œ ì²˜ë¦¬ í›„ ë°ì´í„° ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”
          </div>
        </div>
      `;
      
      // ì²˜ë¦¬ëœ ë°ì´í„° Info ê²°ê³¼
      html += '<h3><i class="fas fa-info-circle" style="margin-right: 0.5rem;"></i>ğŸ“ˆ ì²˜ë¦¬ í›„ ë°ì´í„° ì •ë³´</h3>';
      html += displayInfoResult(processedInfoData);
      
      // ì²˜ë¦¬ëœ ë°ì´í„° Describe ê²°ê³¼
      if (Object.keys(processedDescribeData).length === 0) {
        html += `
          <div class="error">
            <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>
            ì²˜ë¦¬ í›„ ë°ì´í„°ì— ë¶„ì„í•  ìˆ˜ ìˆëŠ” ìˆ«ìí˜• ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
          </div>
        `;
      } else {
        html += '<h3><i class="fas fa-chart-bar" style="margin-right: 0.5rem;"></i>ğŸ“Š ì²˜ë¦¬ í›„ ë°ì´í„° ë¶„ì„ ê²°ê³¼</h3>';
        html += displayDescribeResult(processedDescribeData);
      }
      
      // ì²˜ë¦¬ëœ ë°ì´í„° ê²°ì¸¡ì¹˜ ë¶„ì„ (ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë©”ë‰´ ìˆ¨ê¹€)
      html += '<h3><i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>ğŸ” ì²˜ë¦¬ í›„ ë°ì´í„° ê²°ì¸¡ì¹˜ ë¶„ì„</h3>';
      html += displayMissingDataResult(processedMissingData, true);
      
      resultDiv.innerHTML = html;
      
      // PDF ì¶œë ¥ ë²„íŠ¼ ì¶”ê°€
      if (Object.keys(processedDescribeData).length > 0 || processedMissingData.columns.some(col => col.nullCount > 0)) {
        resultDiv.innerHTML += `
          <div class="pdf-export">
            <button onclick="exportToPDF()">
              <i class="fas fa-file-pdf" style="margin-right: 0.5rem;"></i>
              ğŸ“„ PDFë¡œ ì¶œë ¥í•˜ê¸°
            </button>
            <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
              ğŸ’¡ ë¸Œë¼ìš°ì €ì˜ ì¸ì‡„ ëŒ€í™”ìƒìì—ì„œ "ëŒ€ìƒ"ì„ "PDFë¡œ ì €ì¥"ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”
            </p>
          </div>
        `;
      }
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      setupEventListeners();
    }

    function handleFileUpload(file) {
      console.log('handleFileUpload ì‹œì‘:', file.name, file.size);
      
      const loadingIndicator = document.getElementById('loadingIndicator');
      const resultDiv = document.getElementById('analysisResult');
      
      loadingIndicator.style.display = 'block';
      resultDiv.style.display = 'none';

      // íŒŒì¼ í¬ê¸° ì²´í¬ (50MB ì œí•œ)
      if (file.size > 50 * 1024 * 1024) {
        console.log('íŒŒì¼ì´ ë„ˆë¬´ í¼:', file.size);
        loadingIndicator.style.display = 'none';
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>
            íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤. 50MB ì´í•˜ì˜ íŒŒì¼ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
          </div>
        `;
        return;
      }

      // FileReaderë¥¼ ì‚¬ìš©í•œ ì§ì ‘ íŒŒì¼ ì½ê¸°
      const reader = new FileReader();
      
      reader.onload = function(e) {
        console.log('íŒŒì¼ ì½ê¸° ì™„ë£Œ, í¬ê¸°:', e.target.result.byteLength);
        const arrayBuffer = e.target.result;
        
        // BOM ì œê±° í•¨ìˆ˜
        function removeBOM(content) {
          // UTF-8 BOM ì œê±°
          if (content.charCodeAt(0) === 0xFEFF) {
            return content.slice(1);
          }
          // UTF-16 LE BOM ì œê±°
          if (content.charCodeAt(0) === 0xFFFE) {
            return content.slice(1);
          }
          // UTF-16 BE BOM ì œê±°
          if (content.charCodeAt(0) === 0xFEFF && content.charCodeAt(1) === 0x0000) {
            return content.slice(2);
          }
          return content;
        }
        
        // í•œê¸€ ê¹¨ì§ ê°ì§€ í•¨ìˆ˜ (ìµœì í™”)
        function isKoreanBroken(text) {
          if (!text) return false;
          // ì£¼ìš” ê¹¨ì§„ íŒ¨í„´ë§Œ ì²´í¬
          const brokenPatterns = [/Ã¯Â»Â¿/, /Ã«/, /Ã¬/, /Ã­/, /Ã®/, /Ã¯/];
          return brokenPatterns.some(pattern => pattern.test(text));
        }
        
        // ì¸ì½”ë”© ì‹œë„ (UTF-8 ìš°ì„ )
        const encodings = ['UTF-8', 'EUC-KR', 'CP949'];
        let currentEncodingIndex = 0;
        let lastResults = null;

        function tryParseWithEncoding() {
          console.log('ì¸ì½”ë”© ì‹œë„:', encodings[currentEncodingIndex]);
          
          if (currentEncodingIndex >= encodings.length) {
            console.log('ëª¨ë“  ì¸ì½”ë”© ì‹œë„ ì‹¤íŒ¨');
            loadingIndicator.style.display = 'none';
            
            // ëª¨ë“  ì¸ì½”ë”© ì‹œë„ í›„ì—ë„ ì‹¤íŒ¨í•˜ë©´ ë§ˆì§€ë§‰ ê²°ê³¼ë¥¼ ì‚¬ìš©
            if (lastResults && lastResults.data.length > 0) {
              console.log('ë§ˆì§€ë§‰ ê²°ê³¼ ì‚¬ìš©:', lastResults.data.length, 'í–‰');
              // íŒŒì¼ëª… ì €ì¥
              lastResults.data._fileName = file.name;
              // ì›ë³¸ ë°ì´í„° ë³´ì¡´
              originalData = JSON.parse(JSON.stringify(lastResults.data));
              // ë°ì´í„° ìºì‹œ ì´ˆê¸°í™”
              lastResults.data._numericColumnsCache = null;
              const describeData = calculateDescribe(lastResults.data);
              displayAllResults(describeData, calculateMissingData(lastResults.data), lastResults.data);
            } else {
              resultDiv.style.display = 'block';
              resultDiv.innerHTML = `
                <div class="error">
                  <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>
                  CSV íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì„ UTF-8ë¡œ ì €ì¥í•´ì£¼ì„¸ìš”.
                </div>
              `;
            }
            return;
          }

          const encoding = encodings[currentEncodingIndex];
          
          try {
            const decoder = new TextDecoder(encoding);
            let content = decoder.decode(arrayBuffer);
            
            // BOM ì œê±°
            content = removeBOM(content);
            console.log('ë””ì½”ë”©ëœ ë‚´ìš© ê¸¸ì´:', content.length);
            
            Papa.parse(content, {
              complete: function(results) {
                console.log('Papa.parse ì™„ë£Œ:', results.data.length, 'í–‰, ì˜¤ë¥˜:', results.errors.length);
                lastResults = results;
                
                if (results.errors.length > 0) {
                  console.log('íŒŒì‹± ì˜¤ë¥˜:', results.errors);
                  // ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ ë‹¤ìŒ ì¸ì½”ë”© ì‹œë„
                  currentEncodingIndex++;
                  tryParseWithEncoding();
                  return;
                }
                
                // ë°ì´í„°ê°€ ì œëŒ€ë¡œ íŒŒì‹±ë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (results.data.length === 0 || results.data[0].length === 0) {
                  console.log('ë¹ˆ ë°ì´í„°');
                  currentEncodingIndex++;
                  tryParseWithEncoding();
                  return;
                }
                
                // í•œê¸€ì´ ê¹¨ì¡ŒëŠ”ì§€ í™•ì¸ (ì²« ë²ˆì§¸ ì…€ì—ì„œ í™•ì¸)
                const firstCell = results.data[0][0];
                if (firstCell && isKoreanBroken(firstCell)) {
                  console.log('í•œê¸€ ê¹¨ì§ ê°ì§€:', firstCell);
                  currentEncodingIndex++;
                  tryParseWithEncoding();
                  return;
                }
                
                // ì„±ê³µì ìœ¼ë¡œ íŒŒì‹±ëœ ê²½ìš°
                console.log('íŒŒì‹± ì„±ê³µ!');
                loadingIndicator.style.display = 'none';
                
                // íŒŒì¼ëª… ì €ì¥
                results.data._fileName = file.name;
                
                // ì›ë³¸ ë°ì´í„° ë³´ì¡´
                originalData = JSON.parse(JSON.stringify(results.data));
                
                // ë°ì´í„° ìºì‹œ ì´ˆê¸°í™”
                results.data._numericColumnsCache = null;
                const describeData = calculateDescribe(results.data);
                displayAllResults(describeData, calculateMissingData(results.data), results.data);
              },
              error: function(error) {
                console.log('Papa.parse ì˜¤ë¥˜:', error);
                currentEncodingIndex++;
                tryParseWithEncoding();
              }
            });
          } catch (error) {
            console.log('ë””ì½”ë”© ì˜¤ë¥˜:', error);
            currentEncodingIndex++;
            tryParseWithEncoding();
          }
        }

        tryParseWithEncoding();
      };
      
      reader.onerror = function() {
        console.log('FileReader ì˜¤ë¥˜');
        loadingIndicator.style.display = 'none';
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem;"></i>
            íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
          </div>
        `;
      };
      
      // íŒŒì¼ì„ ArrayBufferë¡œ ì½ê¸°
      reader.readAsArrayBuffer(file);
    }

    // ê²°ì¸¡ì¹˜ ì²˜ë¦¬ í•¨ìˆ˜ë“¤
    function processMissingData(data, columnIndex, method, customValue = null) {
      console.log('=== processMissingData ì‹œì‘ ===');
      console.log('ì…ë ¥ ë°ì´í„°:', data ? data.length : 'null', 'í–‰');
      console.log('ì„ íƒëœ ì—´:', columnIndex);
      console.log('ì²˜ë¦¬ ë°©ë²•:', method);
      
      const processedData = JSON.parse(JSON.stringify(data)); // ê¹Šì€ ë³µì‚¬
      
      if (columnIndex === '') {
        // ì „ì²´ ì—´ ì²˜ë¦¬
        console.log('ì „ì²´ ì—´ ì²˜ë¦¬ ì‹œì‘');
        if (method === 'delete') {
          // delete ë©”ì„œë“œëŠ” íŠ¹ë³„ ì²˜ë¦¬ - ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” í–‰ì„ ëª¨ë‘ ì œê±°
          console.log('delete ë©”ì„œë“œë¡œ ì „ì²´ ì—´ ì²˜ë¦¬');
          const rowsToDelete = new Set();
          
          // ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” í–‰ë“¤ì„ ì°¾ê¸°
          for (let i = 1; i < processedData.length; i++) {
            for (let col = 0; col < processedData[0].length; col++) {
              if (!processedData[i][col] || processedData[i][col].toString().trim() === '') {
                rowsToDelete.add(i);
                break; // í•œ í–‰ì— ê²°ì¸¡ì¹˜ê°€ ìˆìœ¼ë©´ í•´ë‹¹ í–‰ì€ ì‚­ì œ ëŒ€ìƒ
              }
            }
          }
          
          // ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” í–‰ë“¤ì„ ë’¤ì—ì„œë¶€í„° ì‚­ì œ (ì¸ë±ìŠ¤ ë³€ê²½ ë°©ì§€)
          const rowsToDeleteArray = Array.from(rowsToDelete).sort((a, b) => b - a);
          rowsToDeleteArray.forEach(rowIndex => {
            processedData.splice(rowIndex, 1);
          });
          
          console.log(`${rowsToDeleteArray.length}ê°œ í–‰ ì‚­ì œë¨`);
        } else {
          // ë‹¤ë¥¸ ë©”ì„œë“œë“¤ì€ ê° ì—´ì„ ê°œë³„ì ìœ¼ë¡œ ì²˜ë¦¬
          console.log('ê° ì—´ì„ ê°œë³„ì ìœ¼ë¡œ ì²˜ë¦¬');
          for (let col = 0; col < processedData[0].length; col++) {
            // 1ì—´(ì¸ë±ìŠ¤ ì—´)ì€ ë³´í˜¸ - ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ê±´ë„ˆë›°ê¸°
            if (col === 0) {
              console.log(`ì—´ ${col} (ì¸ë±ìŠ¤ ì—´) - ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ê±´ë„ˆë›°ê¸°`);
              continue;
            }
            console.log(`ì—´ ${col} ì²˜ë¦¬ ì‹œì‘`);
            processColumn(processedData, col, method, customValue);
            console.log(`ì—´ ${col} ì²˜ë¦¬ ì™„ë£Œ`);
          }
        }
      } else {
        // íŠ¹ì • ì—´ ì²˜ë¦¬
        console.log('íŠ¹ì • ì—´ ì²˜ë¦¬ ì‹œì‘:', columnIndex);
        processColumn(processedData, parseInt(columnIndex), method, customValue);
      }
      
      console.log('ì²˜ë¦¬ëœ ë°ì´í„°:', processedData.length, 'í–‰');
      console.log('=== processMissingData ì™„ë£Œ ===');
      return processedData;
    }
    
    function processColumn(data, columnIndex, method, customValue = null) {
      console.log(`=== processColumn ì‹œì‘: ì—´ ${columnIndex}, ë°©ë²• ${method} ===`);
      
      const values = [];
      
      // ìœ íš¨í•œ ê°’ë“¤ ìˆ˜ì§‘
      for (let i = 1; i < data.length; i++) {
        if (data[i][columnIndex] && data[i][columnIndex].toString().trim() !== '') {
          values.push(data[i][columnIndex]);
        }
      }
      
      console.log(`ì—´ ${columnIndex}: ìœ íš¨í•œ ê°’ ${values.length}ê°œ`);
      
      if (values.length === 0) {
        console.log(`ì—´ ${columnIndex}: ì²˜ë¦¬í•  ê°’ì´ ì—†ìŒ`);
        return; // ì²˜ë¦¬í•  ê°’ì´ ì—†ìŒ
      }
      
      let replacementValue = '';
      let isNumericReplacement = false;
      
      // í•´ë‹¹ ì»¬ëŸ¼ì´ ìˆ«ìí˜•ì¸ì§€ ë¨¼ì € í™•ì¸
      const numericValues = values.filter(v => !isNaN(parseFloat(v))).map(v => parseFloat(v));
      const isNumericColumn = numericValues.length > 0 && numericValues.length === values.length;
      
      console.log(`ì»¬ëŸ¼ ${columnIndex} ë¶„ì„: ì´ ${values.length}ê°œ ê°’, ìˆ«ìí˜• ${numericValues.length}ê°œ, ìˆ«ìí˜• ì»¬ëŸ¼=${isNumericColumn}`);
      
      switch (method) {
        case 'mean':
          if (numericValues.length > 0) {
            const mean = numericValues.reduce((a, b) => a + b, 0) / numericValues.length;
            replacementValue = mean; // ìˆ«ìë¡œ ìœ ì§€
            isNumericReplacement = true;
            console.log(`í‰ê· ê°’ ê³„ì‚°: ${mean}`);
          } else {
            // ìˆ«ìê°€ ì•„ë‹ˆë©´ ìµœë¹ˆê°’ ì‚¬ìš©
            replacementValue = getMode(values);
            console.log(`ìˆ«ìê°€ ì•„ë‹ˆë¯€ë¡œ ìµœë¹ˆê°’ ì‚¬ìš©: ${replacementValue}`);
          }
          break;
          
        case 'mode':
          if (isNumericColumn) {
            // ìˆ«ìí˜• ì»¬ëŸ¼ì¸ ê²½ìš° ìˆ«ìí˜• ìµœë¹ˆê°’ ê³„ì‚°
            const mode = getNumericMode(numericValues);
            replacementValue = mode;
            isNumericReplacement = true;
            console.log(`ìˆ«ìí˜• ìµœë¹ˆê°’: ${mode}`);
          } else {
            // ë¬¸ìì—´ ì»¬ëŸ¼ì¸ ê²½ìš° ë¬¸ìì—´ ìµœë¹ˆê°’ ì‚¬ìš©
            replacementValue = getMode(values);
            console.log(`ë¬¸ìì—´ ìµœë¹ˆê°’: ${replacementValue}`);
          }
          break;
          
        case 'custom':
          // ì‚¬ìš©ì ì§€ì • ê°’ ì‚¬ìš©
          if (customValue !== null) {
            if (isNumericColumn && !isNaN(parseFloat(customValue))) {
              // ìˆ«ìí˜• ì»¬ëŸ¼ì´ê³  ì‚¬ìš©ì ì§€ì • ê°’ì´ ìˆ«ìì¸ ê²½ìš°
              replacementValue = parseFloat(customValue);
              isNumericReplacement = true;
              console.log(`ìˆ«ìí˜• ì‚¬ìš©ì ì§€ì • ê°’: ${replacementValue}`);
            } else {
              // ë¬¸ìì—´ë¡œ ì²˜ë¦¬
              replacementValue = customValue;
              console.log(`ë¬¸ìì—´ ì‚¬ìš©ì ì§€ì • ê°’: ${replacementValue}`);
            }
          } else {
            // ê¸°ë³¸ê°’ìœ¼ë¡œ ë¹ˆ ë¬¸ìì—´ ì‚¬ìš©
            replacementValue = '';
            console.log('ê¸°ë³¸ê°’ ì‚¬ìš©: ë¹ˆ ë¬¸ìì—´');
          }
          break;
          
        case 'median':
          // ì¤‘ì•™ê°’ìœ¼ë¡œ ëŒ€ì²´ (pandas fillna(df.median())ê³¼ ìœ ì‚¬)
          if (numericValues.length > 0) {
            const sortedValues = [...numericValues].sort((a, b) => a - b);
            const mid = Math.floor(sortedValues.length / 2);
            replacementValue = sortedValues.length % 2 === 0 
              ? (sortedValues[mid - 1] + sortedValues[mid]) / 2 
              : sortedValues[mid];
            isNumericReplacement = true;
            console.log(`ì¤‘ì•™ê°’: ${replacementValue}`);
          } else {
            replacementValue = getMode(values);
            console.log(`ìˆ«ìê°€ ì•„ë‹ˆë¯€ë¡œ ìµœë¹ˆê°’ ì‚¬ìš©: ${replacementValue}`);
          }
          break;
          
        case 'forward_fill':
          // ì•ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸° (pandas fillna(method='ffill')ê³¼ ìœ ì‚¬)
          console.log('ì•ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸° ì‹œì‘');
          for (let i = 1; i < data.length; i++) {
            if (!data[i][columnIndex] || data[i][columnIndex].toString().trim() === '') {
              // ì•ì˜ ìœ íš¨í•œ ê°’ ì°¾ê¸°
              for (let j = i - 1; j >= 1; j--) {
                if (data[j][columnIndex] && data[j][columnIndex].toString().trim() !== '') {
                  data[i][columnIndex] = data[j][columnIndex];
                  console.log(`í–‰ ${i}ë¥¼ í–‰ ${j}ì˜ ê°’ìœ¼ë¡œ ì±„ì›€: ${data[j][columnIndex]}`);
                  break;
                }
              }
            }
          }
          console.log('ì•ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸° ì™„ë£Œ');
          break;
          
        case 'backward_fill':
          // ë’¤ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸° (pandas fillna(method='bfill')ê³¼ ìœ ì‚¬)
          console.log('ë’¤ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸° ì‹œì‘');
          for (let i = data.length - 1; i >= 1; i--) {
            if (!data[i][columnIndex] || data[i][columnIndex].toString().trim() === '') {
              // ë’¤ì˜ ìœ íš¨í•œ ê°’ ì°¾ê¸°
              for (let j = i + 1; j < data.length; j++) {
                if (data[j][columnIndex] && data[j][columnIndex].toString().trim() !== '') {
                  data[i][columnIndex] = data[j][columnIndex];
                  console.log(`í–‰ ${i}ë¥¼ í–‰ ${j}ì˜ ê°’ìœ¼ë¡œ ì±„ì›€: ${data[j][columnIndex]}`);
                  break;
                }
              }
            }
          }
          console.log('ë’¤ì˜ ê°’ìœ¼ë¡œ ì±„ìš°ê¸° ì™„ë£Œ');
          break;
          
        default:
          console.error(`ì•Œ ìˆ˜ ì—†ëŠ” ì²˜ë¦¬ ë°©ë²•: ${method}`);
          return;
      }
      
      // ê²°ì¸¡ì¹˜ë¥¼ ëŒ€ì²´ê°’ìœ¼ë¡œ êµì²´
      let replacedCount = 0;
      for (let i = 1; i < data.length; i++) {
        if (!data[i][columnIndex] || data[i][columnIndex].toString().trim() === '') {
          data[i][columnIndex] = replacementValue;
          replacedCount++;
        }
      }
      
      console.log(`ì»¬ëŸ¼ ${columnIndex} ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ì™„ë£Œ: ${method}, ëŒ€ì²´ê°’=${replacementValue}, ìˆ«ìí˜•=${isNumericReplacement}, êµì²´ëœ ì…€=${replacedCount}ê°œ`);
      console.log(`=== processColumn ì™„ë£Œ ===`);
    }
    
    // ìˆ«ìí˜• ë°ì´í„°ì˜ ìµœë¹ˆê°’ ê³„ì‚° í•¨ìˆ˜
    function getNumericMode(values) {
      const frequency = {};
      let maxFreq = 0;
      let mode = values[0];
      
      values.forEach(value => {
        frequency[value] = (frequency[value] || 0) + 1;
        if (frequency[value] > maxFreq) {
          maxFreq = frequency[value];
          mode = value;
        }
      });
      
      return mode;
    }

    // ë¬¸ìì—´ ë°ì´í„°ì˜ ìµœë¹ˆê°’ ê³„ì‚° í•¨ìˆ˜
    function getMode(values) {
      const frequency = {};
      let maxFreq = 0;
      let mode = values[0];
      
      values.forEach(value => {
        frequency[value] = (frequency[value] || 0) + 1;
        if (frequency[value] > maxFreq) {
          maxFreq = frequency[value];
          mode = value;
        }
      });
      
      return mode;
    }

    // ì‚¬ìš©ì ì§€ì • ê°’ ì…ë ¥ í•„ë“œ í† ê¸€ í•¨ìˆ˜
    function toggleCustomValueInput() {
      const methodSelect = document.getElementById('missingMethodSelect');
      const customValueContainer = document.getElementById('customValueContainer');
      const customValueInput = document.getElementById('customValueInput');
      
      if (methodSelect && customValueContainer) {
        if (methodSelect.value === 'custom') {
          customValueContainer.style.display = 'flex';
          customValueInput.focus();
        } else {
          customValueContainer.style.display = 'none';
          customValueInput.value = '';
        }
      }
    }

    // PDF ì¶œë ¥ í•¨ìˆ˜
    function exportToPDF() {
      // í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ì„ íŒŒì¼ëª…ì— í¬í•¨
      const now = new Date();
      const dateStr = now.getFullYear() + 
                     String(now.getMonth() + 1).padStart(2, '0') + 
                     String(now.getDate()).padStart(2, '0') + '_' +
                     String(now.getHours()).padStart(2, '0') + 
                     String(now.getMinutes()).padStart(2, '0');
      
      // íŒŒì¼ëª… ì„¤ì • (ì—…ë¡œë“œëœ íŒŒì¼ëª…ì´ ìˆìœ¼ë©´ ì‚¬ìš©)
      let fileName = 'CSV_ë¶„ì„ê²°ê³¼';
      if (globalData && globalData._fileName) {
        fileName = globalData._fileName.replace('.csv', '') + '_ë¶„ì„ê²°ê³¼';
      }
      fileName += '_' + dateStr;
      
      // ì¸ì‡„ ëŒ€í™”ìƒì ì—´ê¸°
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>${fileName}</title>
          <style>
            body {
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Noto Sans KR', sans-serif;
              margin: 0;
              padding: 20px;
              color: #333;
            }
            
            .container {
              max-width: 100%;
              background: white;
            }
            
            .header {
              background: #667eea;
              color: white;
              padding: 2rem;
              text-align: center;
              margin-bottom: 2rem;
            }
            
            .header h1 {
              margin: 0;
              font-size: 2rem;
              margin-bottom: 0.5rem;
            }
            
            .header p {
              margin: 0;
              opacity: 0.9;
            }
            
            .analysis-result {
              background: white;
              padding: 0;
            }
            
            .analysis-result h3 {
              color: #667eea;
              margin-top: 0;
              margin-bottom: 1rem;
              text-align: center;
              page-break-after: avoid;
            }
            
            .analysis-result table {
              width: 100%;
              border-collapse: collapse;
              background: white;
              border: 1px solid #ddd;
              margin-bottom: 1rem;
              page-break-inside: avoid;
            }
            
            .analysis-result th {
              background: #667eea;
              color: white;
              padding: 12px 8px;
              text-align: center;
              font-weight: 600;
            }
            
            .analysis-result td {
              padding: 10px 8px;
              text-align: center;
              border-bottom: 1px solid #eee;
            }
            
            .table-container {
              border: 1px solid #ddd;
              margin-bottom: 1rem;
            }
            
            .error {
              background: #ffe6e6;
              color: #d63031;
              padding: 1rem;
              border-radius: 8px;
              border: 1px solid #ff7675;
              text-align: center;
            }
            
            @media print {
              body {
                margin: 0;
                padding: 10px;
              }
              
              .header {
                background: #667eea !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
              }
              
              .analysis-result th {
                background: #667eea !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
              }
            }
          </style>
        </head>
        <body>
          <div class="container">
            <div class="header">
              <h1>ğŸ“Š CSV ë°ì´í„° ë¶„ì„ ê²°ê³¼</h1>
              <p>ìƒì„±ì¼ì‹œ: ${now.getFullYear()}ë…„ ${now.getMonth() + 1}ì›” ${now.getDate()}ì¼ ${now.getHours()}ì‹œ ${now.getMinutes()}ë¶„</p>
            </div>
            <div class="analysis-result">
              ${document.getElementById('analysisResult').innerHTML}
            </div>
          </div>
        </body>
        </html>
      `);
      
      printWindow.document.close();
      
      // ì ì‹œ í›„ ì¸ì‡„ ëŒ€í™”ìƒì ì—´ê¸°
      setTimeout(() => {
        printWindow.print();
        // ì¸ì‡„ í›„ ì°½ ë‹«ê¸° (ì‚¬ìš©ìê°€ ì·¨ì†Œí•  ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ ë°”ë¡œ ë‹«ì§€ ì•ŠìŒ)
        printWindow.onafterprint = function() {
          printWindow.close();
        };
      }, 500);
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOMContentLoaded ì´ë²¤íŠ¸ ë°œìƒ');
      
      // íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.getElementById('fileUpload').addEventListener('click', () => {
        console.log('íŒŒì¼ ì—…ë¡œë“œ í´ë¦­ë¨');
        document.getElementById('csvFile').click();
      });

      document.getElementById('csvFile').addEventListener('change', (e) => {
        console.log('íŒŒì¼ ì„ íƒë¨');
        const file = e.target.files[0];
        if (file) {
          console.log('íŒŒì¼ ì •ë³´:', file.name, file.type, file.size);
          handleFileUpload(file);
        }
      });

      // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥
      const fileUpload = document.getElementById('fileUpload');
      
      fileUpload.addEventListener('dragover', (e) => {
        e.preventDefault();
        fileUpload.classList.add('dragover');
      });

      fileUpload.addEventListener('dragleave', () => {
        fileUpload.classList.remove('dragover');
      });

      fileUpload.addEventListener('drop', (e) => {
        e.preventDefault();
        fileUpload.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        console.log('ë“œë¡­ëœ íŒŒì¼ë“¤:', files);
        
        if (files.length > 0) {
          const file = files[0];
          console.log('ë“œë¡­ëœ íŒŒì¼:', file.name, file.type, file.size);
          
          // íŒŒì¼ íƒ€ì… ì²´í¬ ê°œì„  (í™•ì¥ìë„ í™•ì¸)
          const isCSV = file.type === 'text/csv' || 
                       file.name.toLowerCase().endsWith('.csv') ||
                       file.type === 'application/vnd.ms-excel' ||
                       file.type === 'application/csv';
          
          if (isCSV) {
            handleFileUpload(file);
          } else {
            alert('CSV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤. (íŒŒì¼ëª…: ' + file.name + ', íƒ€ì…: ' + file.type + ')');
          }
        }
      });
      
      console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
    });
  </script>
</body>
</html> 